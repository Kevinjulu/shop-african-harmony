{"version":3,"file":"VendorStore-DjKkr-Nl.js","sources":["../../src/components/vendor/ratings/VendorRating.tsx","../../src/components/vendor/ratings/VendorRatingDisplay.tsx","../../src/components/vendor/store/VendorStore.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { Star } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { useAuth } from \"@/components/AuthProvider\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface VendorRatingProps {\r\n  vendorId: string;\r\n  onRatingSubmit?: () => void;\r\n}\r\n\r\nexport const VendorRating = ({ vendorId, onRatingSubmit }: VendorRatingProps) => {\r\n  const [rating, setRating] = useState(0);\r\n  const [hoveredRating, setHoveredRating] = useState(0);\r\n  const [comment, setComment] = useState(\"\");\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const { user } = useAuth();\r\n\r\n  const handleRatingSubmit = async () => {\r\n    if (!user) {\r\n      toast.error(\"Please login to submit a rating\");\r\n      return;\r\n    }\r\n\r\n    if (rating === 0) {\r\n      toast.error(\"Please select a rating\");\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      const { error } = await supabase.from(\"vendor_ratings\").insert([\r\n        {\r\n          vendor_id: vendorId,\r\n          user_id: user.id,\r\n          rating,\r\n          comment,\r\n        },\r\n      ]);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"Rating submitted successfully\");\r\n      setRating(0);\r\n      setComment(\"\");\r\n      onRatingSubmit?.();\r\n    } catch (error) {\r\n      console.error(\"Error submitting rating:\", error);\r\n      toast.error(\"Failed to submit rating\");\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center gap-1\">\r\n        {[1, 2, 3, 4, 5].map((value) => (\r\n          <button\r\n            key={value}\r\n            type=\"button\"\r\n            onClick={() => setRating(value)}\r\n            onMouseEnter={() => setHoveredRating(value)}\r\n            onMouseLeave={() => setHoveredRating(0)}\r\n            className=\"p-1\"\r\n          >\r\n            <Star\r\n              className={`w-6 h-6 ${\r\n                value <= (hoveredRating || rating)\r\n                  ? \"fill-yellow-400 text-yellow-400\"\r\n                  : \"text-gray-300\"\r\n              }`}\r\n            />\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      <Textarea\r\n        placeholder=\"Share your experience with this vendor (optional)\"\r\n        value={comment}\r\n        onChange={(e) => setComment(e.target.value)}\r\n        className=\"min-h-[100px]\"\r\n      />\r\n\r\n      <Button\r\n        onClick={handleRatingSubmit}\r\n        disabled={isSubmitting || rating === 0}\r\n      >\r\n        Submit Rating\r\n      </Button>\r\n    </div>\r\n  );\r\n};","import { useEffect, useState } from \"react\";\r\nimport { Star } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\ninterface VendorRatingDisplayProps {\r\n  vendorId: string;\r\n}\r\n\r\ninterface Rating {\r\n  rating: number;\r\n  comment: string;\r\n  created_at: string;\r\n  profiles: {\r\n    full_name: string | null;\r\n    username: string | null;\r\n  };\r\n}\r\n\r\nexport const VendorRatingDisplay = ({ vendorId }: VendorRatingDisplayProps) => {\r\n  const [ratings, setRatings] = useState<Rating[]>([]);\r\n  const [averageRating, setAverageRating] = useState(0);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchRatings = async () => {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"vendor_ratings\")\r\n          .select(`\r\n            rating,\r\n            comment,\r\n            created_at,\r\n            profiles (\r\n              full_name,\r\n              username\r\n            )\r\n          `)\r\n          .eq(\"vendor_id\", vendorId)\r\n          .order(\"created_at\", { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        setRatings(data || []);\r\n        \r\n        // Calculate average rating\r\n        if (data && data.length > 0) {\r\n          const avg = data.reduce((acc, curr) => acc + curr.rating, 0) / data.length;\r\n          setAverageRating(Math.round(avg * 10) / 10);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching ratings:\", error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRatings();\r\n\r\n    // Set up real-time subscription\r\n    const channel = supabase\r\n      .channel('vendor-ratings')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'vendor_ratings',\r\n          filter: `vendor_id=eq.${vendorId}`\r\n        },\r\n        () => {\r\n          fetchRatings();\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [vendorId]);\r\n\r\n  if (isLoading) {\r\n    return <div>Loading ratings...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <div className=\"flex items-center\">\r\n          {[1, 2, 3, 4, 5].map((value) => (\r\n            <Star\r\n              key={value}\r\n              className={`w-5 h-5 ${\r\n                value <= averageRating\r\n                  ? \"fill-yellow-400 text-yellow-400\"\r\n                  : \"text-gray-300\"\r\n              }`}\r\n            />\r\n          ))}\r\n        </div>\r\n        <span className=\"text-lg font-medium\">\r\n          {averageRating} ({ratings.length} reviews)\r\n        </span>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        {ratings.map((rating, index) => (\r\n          <div key={index} className=\"border rounded-lg p-4\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <div className=\"flex items-center gap-2\">\r\n                {[1, 2, 3, 4, 5].map((value) => (\r\n                  <Star\r\n                    key={value}\r\n                    className={`w-4 h-4 ${\r\n                      value <= rating.rating\r\n                        ? \"fill-yellow-400 text-yellow-400\"\r\n                        : \"text-gray-300\"\r\n                    }`}\r\n                  />\r\n                ))}\r\n              </div>\r\n              <span className=\"text-sm text-gray-500\">\r\n                {new Date(rating.created_at).toLocaleDateString()}\r\n              </span>\r\n            </div>\r\n            <p className=\"text-sm font-medium\">\r\n              {rating.profiles.full_name || rating.profiles.username || \"Anonymous\"}\r\n            </p>\r\n            {rating.comment && (\r\n              <p className=\"mt-2 text-gray-600\">{rating.comment}</p>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};","import { useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { VendorRating } from \"../ratings/VendorRating\";\r\nimport { VendorRatingDisplay } from \"../ratings/VendorRatingDisplay\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardDescription,\r\n  CardHeader,\r\n  CardTitle,\r\n} from \"@/components/ui/card\";\r\n\r\ninterface VendorProfile {\r\n  id: string;\r\n  business_name: string;\r\n  description: string;\r\n  logo_url: string;\r\n}\r\n\r\nconst VendorStore = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const [vendor, setVendor] = useState<VendorProfile | null>(null);\r\n  const [showRatingForm, setShowRatingForm] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchVendor = async () => {\r\n      if (!id) return;\r\n\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"vendor_profiles\")\r\n          .select(\"*\")\r\n          .eq(\"id\", id)\r\n          .single();\r\n\r\n        if (error) throw error;\r\n        setVendor(data);\r\n      } catch (error) {\r\n        console.error(\"Error fetching vendor:\", error);\r\n      }\r\n    };\r\n\r\n    fetchVendor();\r\n  }, [id]);\r\n\r\n  if (!vendor) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center gap-4\">\r\n            {vendor.logo_url && (\r\n              <img\r\n                src={vendor.logo_url}\r\n                alt={vendor.business_name}\r\n                className=\"w-16 h-16 rounded-full object-cover\"\r\n              />\r\n            )}\r\n            <div>\r\n              <CardTitle>{vendor.business_name}</CardTitle>\r\n              <CardDescription>{vendor.description}</CardDescription>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-6\">\r\n            <VendorRatingDisplay vendorId={vendor.id} />\r\n            \r\n            <div className=\"border-t pt-6\">\r\n              {showRatingForm ? (\r\n                <VendorRating\r\n                  vendorId={vendor.id}\r\n                  onRatingSubmit={() => setShowRatingForm(false)}\r\n                />\r\n              ) : (\r\n                <Button onClick={() => setShowRatingForm(true)}>\r\n                  Write a Review\r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VendorStore;"],"names":["VendorRating","vendorId","onRatingSubmit","rating","setRating","useState","hoveredRating","setHoveredRating","comment","setComment","isSubmitting","setIsSubmitting","user","useAuth","handleRatingSubmit","toast","error","supabase","jsxs","jsx","value","Star","Textarea","e","Button","VendorRatingDisplay","ratings","setRatings","averageRating","setAverageRating","isLoading","setIsLoading","useEffect","fetchRatings","data","avg","acc","curr","channel","index","VendorStore","id","useParams","vendor","setVendor","showRatingForm","setShowRatingForm","Card","CardHeader","CardTitle","CardDescription","CardContent"],"mappings":"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"}