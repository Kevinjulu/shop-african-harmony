var k=e=>{throw TypeError(e)};var S=(e,s,r)=>s.has(e)||k("Cannot "+r);var i=(e,s,r)=>(S(e,s,"read from private field"),r?r.call(e):s.get(e)),f=(e,s,r)=>s.has(e)?k("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,r),g=(e,s,r,a)=>(S(e,s,"write to private field"),a?a.call(e,r):s.set(e,r),r),j=(e,s,r)=>(S(e,s,"access private method"),r);import{j as t}from"./ui-vendor-DUvlyADh.js";import{E as P,F as Q,G as M,K as D,L as R,M as F,O as U,Q as B,o as H,u as A,s as _,J as q,g as I,C as J,B as N,P as T}from"./index-hIbkmTRc.js";import{r as b,u as C}from"./react-vendor-BVHdP9Rw.js";import{S as $}from"./separator-DgK7aHvU.js";import{S as L}from"./shopping-bag-BVR2wfG7.js";var p,x,n,l,u,w,E,K,G=(K=class extends P{constructor(s,r){super();f(this,u);f(this,p);f(this,x);f(this,n);f(this,l);g(this,p,s),this.setOptions(r),this.bindMethods(),j(this,u,w).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){var a;const r=this.options;this.options=i(this,p).defaultMutationOptions(s),Q(this.options,r)||i(this,p).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,n),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&M(r.mutationKey)!==M(this.options.mutationKey)?this.reset():((a=i(this,n))==null?void 0:a.state.status)==="pending"&&i(this,n).setOptions(this.options)}onUnsubscribe(){var s;this.hasListeners()||(s=i(this,n))==null||s.removeObserver(this)}onMutationUpdate(s){j(this,u,w).call(this),j(this,u,E).call(this,s)}getCurrentResult(){return i(this,x)}reset(){var s;(s=i(this,n))==null||s.removeObserver(this),g(this,n,void 0),j(this,u,w).call(this),j(this,u,E).call(this)}mutate(s,r){var a;return g(this,l,r),(a=i(this,n))==null||a.removeObserver(this),g(this,n,i(this,p).getMutationCache().build(i(this,p),this.options)),i(this,n).addObserver(this),i(this,n).execute(s)}},p=new WeakMap,x=new WeakMap,n=new WeakMap,l=new WeakMap,u=new WeakSet,w=function(){var r;const s=((r=i(this,n))==null?void 0:r.state)??D();g(this,x,{...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset})},E=function(s){R.batch(()=>{var r,a,o,d,h,c,m,v;if(i(this,l)&&this.hasListeners()){const y=i(this,x).variables,O=i(this,x).context;(s==null?void 0:s.type)==="success"?((a=(r=i(this,l)).onSuccess)==null||a.call(r,s.data,y,O),(d=(o=i(this,l)).onSettled)==null||d.call(o,s.data,null,y,O)):(s==null?void 0:s.type)==="error"&&((c=(h=i(this,l)).onError)==null||c.call(h,s.error,y,O),(v=(m=i(this,l)).onSettled)==null||v.call(m,void 0,s.error,y,O))}this.listeners.forEach(y=>{y(i(this,x))})})},K);function V(e,s){const r=F(),[a]=b.useState(()=>new G(r,e));b.useEffect(()=>{a.setOptions(e)},[a,e]);const o=b.useSyncExternalStore(b.useCallback(h=>a.subscribe(R.batchCalls(h)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),d=b.useCallback((h,c)=>{a.mutate(h,c).catch(U)},[a]);if(o.error&&B(a.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:d,mutateAsync:o.mutate}}const Y=()=>{const{user:e}=H(),s=F(),r=async()=>{if(console.log("Fetching orders for user:",e==null?void 0:e.id),!e)throw new Error("User not authenticated");const{data:c,error:m}=await _.from("orders").select(`
        *,
        shipping_address:shipping_addresses(*),
        items:order_items(
          *,
          product:products(name, image_url)
        )
      `).eq("user_id",e.id).order("created_at",{ascending:!1});if(m)throw console.error("Error fetching orders:",m),m;return c},{data:a,isLoading:o,error:d}=A({queryKey:["orders",e==null?void 0:e.id],queryFn:r,enabled:!!e}),h=V({mutationFn:async({orderId:c,status:m})=>{const{error:v}=await _.from("orders").update({status:m}).eq("id",c);if(v)throw v},onSuccess:()=>{s.invalidateQueries({queryKey:["orders"]}),q.success("Order status updated successfully")},onError:c=>{console.error("Error updating order status:",c),q.error("Failed to update order status")}});return{orders:a,isLoading:o,error:d,updateOrderStatus:h}},z=({order:e})=>{const{formatPrice:s}=I(),r=C();return t.jsxs(J,{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"font-semibold",children:["Order #",e.id]}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Placed on ",new Date(e.created_at).toLocaleDateString()]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"font-medium",children:s(e.total_amount)}),t.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full bg-primary/10 text-primary",children:e.status})]})]}),t.jsx($,{className:"my-4"}),t.jsx("div",{className:"space-y-4",children:e.items.map(a=>t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("img",{src:a.product.image_url||"/placeholder.svg",alt:a.product.name,className:"w-16 h-16 object-cover rounded"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:a.product.name}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Quantity: ",a.quantity]})]})]},a.id))}),t.jsxs("div",{className:"mt-4 flex justify-end space-x-4",children:[t.jsx(N,{variant:"outline",onClick:()=>r(`/order/${e.id}`),children:"View Details"}),e.tracking_number&&t.jsxs(N,{variant:"secondary",className:"flex items-center gap-2",onClick:()=>r(`/order/${e.id}`),children:[t.jsx(T,{className:"w-4 h-4"}),"Track Order"]})]})]})},W=()=>{const e=C();return t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold",children:"Order History"}),t.jsxs(N,{onClick:()=>e("/"),variant:"outline",className:"flex items-center gap-2",children:[t.jsx(L,{className:"w-4 h-4"}),"Continue Shopping"]})]})},X=()=>{const e=C();return t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("p",{className:"text-gray-600",children:"You haven't placed any orders yet."}),t.jsxs(N,{onClick:()=>e("/"),className:"flex items-center gap-2",children:[t.jsx(L,{className:"w-4 h-4"}),"Start Shopping"]})]})},is=()=>{const{orders:e,isLoading:s,error:r}=Y(),a=C(),{user:o}=H();return o?s?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),t.jsx("div",{className:"h-32 bg-gray-200 rounded"}),t.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}):r?t.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[t.jsx("p",{className:"text-red-500 mb-4",children:"Failed to load orders"}),t.jsx(N,{onClick:()=>a("/"),children:"Return Home"})]}):t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx(W,{}),e!=null&&e.length?t.jsx("div",{className:"space-y-6",children:e.map(d=>t.jsx(z,{order:d},d.id))}):t.jsx(X,{})]})}):(a("/auth"),null)};export{is as default};
//# sourceMappingURL=OrderHistory-BOev0BbI.js.map
