import{j as e}from"./ui-vendor-DUvlyADh.js";import{c as _,s as C,u as F,I as p,S as B,a as L,b as E,B as H,d as Q,e as T,f as k,g as A,J as R,N as I,C as w,h as P,i as v}from"./index-hIbkmTRc.js";import{l as O,r as x,L as V}from"./react-vendor-BVHdP9Rw.js";import{d as q}from"./debounce-B64j741o.js";import{S as y,a as f,b as N,c as S,d as i}from"./select-YRxIW6H_.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=_("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),G=async(r,a={})=>{console.log("Searching products with:",{query:r,filters:a});let s=C.from("products").select("*");switch(r&&(s=s.textSearch("search_vector",r)),a.category&&a.category!=="all"&&(s=s.eq("category",a.category)),a.minPrice&&(s=s.gte("price",a.minPrice)),a.maxPrice&&(s=s.lte("price",a.maxPrice)),a.origin&&(s=s.eq("origin_country",a.origin)),a.sortBy){case"price_asc":s=s.order("price",{ascending:!0});break;case"price_desc":s=s.order("price",{ascending:!1});break;case"newest":s=s.order("created_at",{ascending:!1});break;default:r?s=s.order("search_vector",{ascending:!1}):s=s.order("created_at",{ascending:!1})}const{data:m,error:t}=await s;if(t)throw console.error("Error searching products:",t),t;return m},J=async(r,a)=>{const{error:s}=await C.from("search_history").insert([{query:r,filters:a}]);s&&console.error("Error saving search history:",s)},K=()=>{const[r,a]=O(),[s,m]=x.useState(r.get("search")||""),t={category:r.get("category")||"all",minPrice:r.get("minPrice")?Number(r.get("minPrice")):void 0,maxPrice:r.get("maxPrice")?Number(r.get("maxPrice")):void 0,sortBy:r.get("sortBy")||"relevance",origin:r.get("origin")||void 0},{data:g,isLoading:o,error:u}=F({queryKey:["products",s,t],queryFn:()=>G(s,t)}),l=x.useCallback(q(n=>{m(n),n.trim()&&J(n,t)},300),[t]),d=n=>{const h=new URLSearchParams(r);n?h.set("search",n):h.delete("search"),a(h),l(n)},c=n=>{const h=new URLSearchParams(r);Object.entries(n).forEach(([b,j])=>{j&&j!=="all"?h.set(b,j.toString()):h.delete(b)}),a(h)};return x.useEffect(()=>()=>{l.cancel()},[l]),{query:r.get("search")||"",filters:t,products:g||[],isLoading:o,error:u,updateSearch:d,updateFilters:c}},z=({initialQuery:r,initialFilters:a,onQueryChange:s,onFiltersChange:m})=>{const[t,g]=x.useState(r);x.useState(!1);const[o,u]=x.useState(a);x.useEffect(()=>{u(a)},[a]);const l=c=>{c.preventDefault(),s(t)},d=(c,n)=>{const h={...o,[c]:n};u(h),m({[c]:n})};return e.jsx("div",{className:"space-y-4",children:e.jsxs("form",{onSubmit:l,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(p,{type:"text",placeholder:"Search products...",value:t,onChange:c=>g(c.target.value),className:"pl-10"}),e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"})]}),e.jsxs(L,{children:[e.jsx(E,{asChild:!0,children:e.jsx(H,{variant:"outline",size:"icon",children:e.jsx(D,{className:"h-4 w-4"})})}),e.jsxs(Q,{children:[e.jsx(T,{children:e.jsx(k,{children:"Filters"})}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(y,{value:o.category,onValueChange:c=>d("category",c),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select category"})}),e.jsxs(S,{children:[e.jsx(i,{value:"all",children:"All Categories"}),e.jsx(i,{value:"fashion",children:"Fashion"}),e.jsx(i,{value:"jewelry",children:"Jewelry"}),e.jsx(i,{value:"art",children:"Art"}),e.jsx(i,{value:"home_decor",children:"Home Decor"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Sort By"}),e.jsxs(y,{value:o.sortBy,onValueChange:c=>d("sortBy",c),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Sort by"})}),e.jsxs(S,{children:[e.jsx(i,{value:"relevance",children:"Relevance"}),e.jsx(i,{value:"price_asc",children:"Price: Low to High"}),e.jsx(i,{value:"price_desc",children:"Price: High to Low"}),e.jsx(i,{value:"newest",children:"Newest First"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Price Range"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(p,{type:"number",value:o.minPrice||"",onChange:c=>d("minPrice",c.target.value?Number(c.target.value):void 0),placeholder:"Min",className:"w-24"}),e.jsx("span",{children:"to"}),e.jsx(p,{type:"number",value:o.maxPrice||"",onChange:c=>d("maxPrice",c.target.value?Number(c.target.value):void 0),placeholder:"Max",className:"w-24"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Origin"}),e.jsxs(y,{value:o.origin,onValueChange:c=>d("origin",c),children:[e.jsx(f,{children:e.jsx(N,{placeholder:"Select origin"})}),e.jsxs(S,{children:[e.jsx(i,{value:"all",children:"All Origins"}),e.jsx(i,{value:"KE",children:"Kenya"}),e.jsx(i,{value:"NG",children:"Nigeria"}),e.jsx(i,{value:"GH",children:"Ghana"}),e.jsx(i,{value:"TZ",children:"Tanzania"})]})]})]})]})]})]})]})})},Y=()=>{const{formatPrice:r}=A(),{products:a,isLoading:s,error:m,query:t,filters:g,updateSearch:o,updateFilters:u}=K();return m&&R.error("Failed to load products"),e.jsxs("div",{children:[e.jsx(I,{}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-secondary",children:"Our Products"}),t&&e.jsxs("p",{className:"text-gray-600",children:['Showing results for: "',t,'"']})]}),e.jsx("div",{className:"mb-6",children:e.jsx(z,{initialQuery:t,initialFilters:g,onQueryChange:o,onFiltersChange:u})}),s?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 md:gap-4",children:[...Array(10)].map((l,d)=>e.jsx(w,{className:"hover:shadow-md transition-shadow",children:e.jsxs(P,{className:"p-2 md:p-3",children:[e.jsx(v,{className:"aspect-square w-full mb-2"}),e.jsx(v,{className:"h-3 w-3/4 mb-1"}),e.jsx(v,{className:"h-3 w-1/2"})]})},d))}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 md:gap-4",children:a.map(l=>e.jsx(V,{to:`/product/${l.id}`,children:e.jsx(w,{className:"hover:shadow-md transition-shadow",children:e.jsxs(P,{className:"p-2 md:p-3",children:[e.jsx("div",{className:"aspect-square relative mb-2",children:e.jsx("img",{src:l.image_url||"/placeholder.svg",alt:l.name,className:"w-full h-full object-cover rounded-md"})}),e.jsx("h3",{className:"text-sm font-medium text-secondary line-clamp-2",children:l.name}),e.jsx("p",{className:"text-base font-bold text-primary mt-1",children:r(l.price)}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:l.category})]})})},l.id))}),!s&&a.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-600 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria"})]})]})]})};export{Y as default};
//# sourceMappingURL=Products-DVGw6-UO.js.map
