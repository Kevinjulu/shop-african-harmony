import{j as e}from"./ui-vendor-DUvlyADh.js";import{r as n,m as y}from"./react-vendor-BVHdP9Rw.js";import{o as w,n as p,B as j,J as g,s as x,C as N,x as b,y as _,z as S,h as C}from"./index-hIbkmTRc.js";import{T as R}from"./textarea-EeofsJfB.js";const E=({vendorId:i,onRatingSubmit:t})=>{const[o,l]=n.useState(0),[d,m]=n.useState(0),[c,s]=n.useState(""),[h,r]=n.useState(!1),{user:u}=w(),f=async()=>{if(!u){g.error("Please login to submit a rating");return}if(o===0){g.error("Please select a rating");return}r(!0);try{const{error:a}=await x.from("vendor_ratings").insert([{vendor_id:i,user_id:u.id,rating:o,comment:c}]);if(a)throw a;g.success("Rating submitted successfully"),l(0),s(""),t==null||t()}catch(a){console.error("Error submitting rating:",a),g.error("Failed to submit rating")}finally{r(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",onClick:()=>l(a),onMouseEnter:()=>m(a),onMouseLeave:()=>m(0),className:"p-1",children:e.jsx(p,{className:`w-6 h-6 ${a<=(d||o)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},a))}),e.jsx(R,{placeholder:"Share your experience with this vendor (optional)",value:c,onChange:a=>s(a.target.value),className:"min-h-[100px]"}),e.jsx(j,{onClick:f,disabled:h||o===0,children:"Submit Rating"})]})},L=({vendorId:i})=>{const[t,o]=n.useState([]),[l,d]=n.useState(0),[m,c]=n.useState(!0);return n.useEffect(()=>{const s=async()=>{try{const{data:r,error:u}=await x.from("vendor_ratings").select(`
            rating,
            comment,
            created_at,
            profiles (
              full_name,
              username
            )
          `).eq("vendor_id",i).order("created_at",{ascending:!1});if(u)throw u;if(o(r||[]),r&&r.length>0){const f=r.reduce((a,v)=>a+v.rating,0)/r.length;d(Math.round(f*10)/10)}}catch(r){console.error("Error fetching ratings:",r)}finally{c(!1)}};s();const h=x.channel("vendor-ratings").on("postgres_changes",{event:"*",schema:"public",table:"vendor_ratings",filter:`vendor_id=eq.${i}`},()=>{s()}).subscribe();return()=>{x.removeChannel(h)}},[i]),m?e.jsx("div",{children:"Loading ratings..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center",children:[1,2,3,4,5].map(s=>e.jsx(p,{className:`w-5 h-5 ${s<=l?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},s))}),e.jsxs("span",{className:"text-lg font-medium",children:[l," (",t.length," reviews)"]})]}),e.jsx("div",{className:"space-y-4",children:t.map((s,h)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(r=>e.jsx(p,{className:`w-4 h-4 ${r<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},r))}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-sm font-medium",children:s.profiles.full_name||s.profiles.username||"Anonymous"}),s.comment&&e.jsx("p",{className:"mt-2 text-gray-600",children:s.comment})]},h))})]})},q=()=>{const{id:i}=y(),[t,o]=n.useState(null),[l,d]=n.useState(!1);return n.useEffect(()=>{(async()=>{if(i)try{const{data:c,error:s}=await x.from("vendor_profiles").select("*").eq("id",i).single();if(s)throw s;o(c)}catch(c){console.error("Error fetching vendor:",c)}})()},[i]),t?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.logo_url&&e.jsx("img",{src:t.logo_url,alt:t.business_name,className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx(_,{children:t.business_name}),e.jsx(S,{children:t.description})]})]})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{vendorId:t.id}),e.jsx("div",{className:"border-t pt-6",children:l?e.jsx(E,{vendorId:t.id,onRatingSubmit:()=>d(!1)}):e.jsx(j,{onClick:()=>d(!0),children:"Write a Review"})})]})})]})}):e.jsx("div",{children:"Loading..."})};export{q as default};
//# sourceMappingURL=VendorStore-DjKkr-Nl.js.map
